#!/usr/bin/env python

import readmd
import sys
import os
import argparse

DESCRIPTION = 'Convert a markdown file into pretty-printed markdown. The output will be able to generate the same HTML output as the original markdown file, but it gains the ability of being more readable as plain-text. If no files are specified, then it tries to read from `README.md` in the current directory.'

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description=DESCRIPTION)
    parser.add_argument('-w', '--width', type=int,
                        default=readmd.DEFAULT_WIDTH,
                        help=('characters per line for printing out text, '
                              'make -1 to fit current screen width, '
                              'defaults to %s' % (readmd.DEFAULT_WIDTH,)))
    parser.add_argument('infile', nargs='?', type=argparse.FileType('r'),
                        default=None)
    parser.add_argument('outfile', nargs='?', type=argparse.FileType('w'),
                        default=sys.stdout)
    args = parser.parse_args()

    if args.infile is None:
        default_in = 'README.md'
        if os.path.exists(default_in):
            args.infile = open(default_in)
        else:
            parser.error('Unable to find a default %s file. '
                         'Please specify a file to read.' % (default_in,))

    readmd.readmd(args.infile, width=args.width, out=args.outfile)
